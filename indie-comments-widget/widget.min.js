class IndieCommentsWidget extends HTMLElement{constructor(){super(),console.log("IndieCommentsWidget constructor called"),this.threadId=this.getAttribute("thread-id")||window.location.pathname,this.apiBaseUrl=this.getAttribute("api-base-url")||"http://localhost:8000",this.containerId="indie-comments-container",this.moderationEnabled=!1,this.comments=[],this.themes={default:"\n/* Default Theme - Widget styles */\n#indie-comments-app {\n    background: #fff !important;\n    color: #333 !important;\n    border: 1px solid #e0e0e0 !important;\n}\n#indie-comments-form-container {\n    background: #f8f9fa !important;\n    border: 1px solid #e9ecef !important;\n}\n.indie-comments-comment {\n    background: #fff !important;\n    border: 1px solid #eee !important;\n    color: #444 !important;\n}\n.indie-comments-author {\n    color: #333 !important;\n}\n.indie-comments-date {\n    color: #888 !important;\n}\n.indie-comments-content {\n    color: #444 !important;\n}\n#indie-comments-form button {\n    background: #007cba !important;\n    color: white !important;\n}\n#indie-comments-form button:hover {\n    background: #005a87 !important;\n}\n.indie-comments-input-group input,\n.indie-comments-input-group textarea {\n    background: #fff !important;\n    border-color: #ddd !important;\n    color: #333 !important;\n}\n#indie-comments-theme-select {\n    background: #fff !important;\n    border-color: #ddd !important;\n    color: #333 !important;\n}\n.indie-comments-empty {\n    color: #666 !important;\n}\n            ",dark:"\n/* Dark Theme - Widget styles */\n#indie-comments-app {\n    background: #2d2d2d !important;\n    color: #e0e0e0 !important;\n    border: 1px solid #444 !important;\n}\n#indie-comments-form-container {\n    background: #3a3a3a !important;\n    border: 1px solid #555 !important;\n}\n.indie-comments-comment {\n    background: #2d2d2d !important;\n    border: 1px solid #444 !important;\n    color: #e0e0e0 !important;\n}\n.indie-comments-author {\n    color: #4fc3f7 !important;\n}\n.indie-comments-date {\n    color: #b0b0b0 !important;\n}\n.indie-comments-content {\n    color: #e0e0e0 !important;\n}\n#indie-comments-form button {\n    background: #4fc3f7 !important;\n    color: #000 !important;\n}\n#indie-comments-form button:hover {\n    background: #29b6f6 !important;\n}\n.indie-comments-input-group input,\n.indie-comments-input-group textarea {\n    background: #3a3a3a !important;\n    border-color: #555 !important;\n    color: #e0e0e0 !important;\n}\n#indie-comments-theme-select {\n    background: #3a3a3a !important;\n    border-color: #555 !important;\n    color: #e0e0e0 !important;\n}\n.indie-comments-empty {\n    color: #b0b0b0 !important;\n}\n            ",matrix:"\n/* Matrix Theme - Widget styles */\n#indie-comments-app {\n    background: #000 !important;\n    color: #0f0 !important;\n    border: 1px solid #0a0 !important;\n    font-family: 'Courier New', monospace !important;\n}\n#indie-comments-form-container {\n    background: #010 !important;\n    border: 1px solid #080 !important;\n}\n.indie-comments-comment {\n    background: #000 !important;\n    border: 1px solid #0a0 !important;\n    color: #0f0 !important;\n    font-family: 'Courier New', monospace !important;\n}\n.indie-comments-author {\n    color: #0f0 !important;\n}\n.indie-comments-date {\n    color: #6b7280 !important;\n}\n.indie-comments-content {\n    color: #0f0 !important;\n}\n#indie-comments-form button {\n    background: #0a0 !important;\n    color: #000 !important;\n    font-family: 'Courier New', monospace !important;\n}\n#indie-comments-form button:hover {\n    background: #0f0 !important;\n    box-shadow: 0 0 5px rgba(0, 255, 0, 0.5) !important;\n}\n.indie-comments-input-group input,\n.indie-comments-input-group textarea {\n    background: #010 !important;\n    border-color: #080 !important;\n    color: #0f0 !important;\n    font-family: 'Courier New', monospace !important;\n}\n#indie-comments-theme-select {\n    background: #010 !important;\n    border-color: #080 !important;\n    color: #0f0 !important;\n    font-family: 'Courier New', monospace !important;\n}\n.indie-comments-empty {\n    color: #6b7280 !important;\n}\n            ",neocities:"\n/* NeoCities Theme - Widget styles */\n#indie-comments-app {\n    background: #ccffff !important;\n    color: #330033 !important;\n    border: 2px dashed #996699 !important;\n}\n#indie-comments-form-container {\n    background: #ffff99 !important;\n    border: 2px dotted #669966 !important;\n}\n.indie-comments-comment {\n    background: #ccffff !important;\n    border: 2px dashed #996699 !important;\n    color: #330033 !important;\n}\n.indie-comments-author {\n    color: #663399 !important;\n}\n.indie-comments-date {\n    color: #666699 !important;\n}\n.indie-comments-content {\n    color: #330033 !important;\n}\n#indie-comments-form button {\n    background: #ffccff !important;\n    color: #330033 !important;\n    border: 2px solid #996699 !important;\n}\n#indie-comments-form button:hover {\n    background: #ff99ff !important;\n}\n.indie-comments-input-group input,\n.indie-comments-input-group textarea {\n    background: #ffff99 !important;\n    border: 2px dotted #669966 !important;\n    color: #330033 !important;\n}\n#indie-comments-theme-select {\n    background: #ffff99 !important;\n    border: 2px dotted #669966 !important;\n    color: #330033 !important;\n}\n.indie-comments-empty {\n    color: #666699 !important;\n}\n            "},this.currentTheme="default",this.shadow=this.attachShadow({mode:"open"}),this.render(),this.init()}async init(){console.log("IndieCommentsWidget init called");try{await this.loadThreadStatus(),await this.loadComments(),this.render()}catch(n){console.error("Error initializing Indie Comments Widget:",n),this.render()}}async loadThreadStatus(){try{const n=await fetch(`${this.apiBaseUrl}/api/v1/threads/${this.threadId}/status`),e=await n.json();e.exists?this.moderationEnabled=e.moderation_enabled:console.log("Thread does not exist yet, will be created on first comment")}catch(n){console.error("Error loading thread status:",n)}}async loadComments(){try{const n=await fetch(`${this.apiBaseUrl}/api/v1/comments/${this.threadId}`),e=await n.json();this.comments=e.comments||[]}catch(n){console.error("Error loading comments:",n)}}async submitComment(n){try{const e=await fetch(`${this.apiBaseUrl}/api/v1/comments/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({thread_id:this.threadId,...n})}),t=await e.json();if(e.ok)return this.clearForm(),this.showMessage("Comment submitted for moderation"),await this.loadComments(),this.render(),t;throw new Error(t.detail||"Failed to submit comment")}catch(n){throw console.error("Error submitting comment:",n),this.showError(n.message||"Failed to submit comment"),n}}clearForm(){const n=this.shadow.querySelector("#indie-comments-form");n&&n.reset()}showMessage(n){const e=this.shadow.querySelector("#indie-comments-message");e&&(e.textContent=n,e.className="indie-comments-message success",setTimeout(()=>{e.textContent="",e.className="indie-comments-message"},3e3))}showError(n){const e=this.shadow.querySelector("#indie-comments-message");e&&(e.textContent=n,e.className="indie-comments-message error",setTimeout(()=>{e.textContent="",e.className="indie-comments-message"},5e3))}formatDate(n){const e=new Date(n);return e.toLocaleDateString()+" "+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}renderComment(n,e=0){const t=document.createElement("div");return t.className=`indie-comments-comment level-${e}`,t.innerHTML=`\n            <div class="indie-comments-comment-header">\n                <strong class="indie-comments-author">${n.author_name}</strong>\n                <span class="indie-comments-date">${this.formatDate(n.created_at)}</span>\n            </div>\n            <div class="indie-comments-content">${n.content}</div>\n            <div class="indie-comments-replies">\n                ${n.replies&&n.replies.length>0?n.replies.map(n=>this.renderComment(n,e+1)).join(""):""}\n            </div>\n        `,t}render(){console.log("IndieCommentsWidget render called, current theme:",this.currentTheme),this.shadow.innerHTML="";const n=document.createElement("style");n.textContent=`\n/* Base widget styles - theme-specific styles will override these */\n#indie-comments-app {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    max-width: 680px;\n    margin: 2rem auto;\n    padding: 1.5rem;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    transition: background-color 0.25s ease, color 0.25s ease, border-color 0.25s ease;\n}\n#indie-comments-header {\n    margin-bottom: 1.5rem;\n}\n#indie-comments-header h3 {\n    margin: 0 0 1rem 0;\n    font-size: 1.5rem;\n    font-weight: 600;\n}\n.indie-comments-message {\n    padding: 0.5rem 0;\n    font-size: 0.9rem;\n}\n.indie-comments-message.success {\n    color: #28a745;\n}\n.indie-comments-message.error {\n    color: #dc3545;\n}\n#indie-comments-form-container {\n    padding: 1.5rem;\n    border-radius: 6px;\n    margin-bottom: 2rem;\n}\n.indie-comments-input-group {\n    margin-bottom: 1rem;\n}\n.indie-comments-input-group input,\n.indie-comments-input-group textarea {\n    width: 100%;\n    padding: 0.75rem;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    font-size: 1rem;\n    box-sizing: border-box;\n}\n.indie-comments-input-group textarea {\n    min-height: 100px;\n    resize: vertical;\n}\n#indie-comments-form button {\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 4px;\n    font-size: 1rem;\n    cursor: pointer;\n    transition: background 0.2s;\n}\n#indie-comments-list {\n    margin-top: 1.5rem;\n}\n.indie-comments-empty {\n    text-align: center;\n    font-style: italic;\n    padding: 2rem;\n}\n.indie-comments-comment {\n    border-radius: 6px;\n    padding: 1rem;\n    margin-bottom: 1rem;\n}\n.indie-comments-comment.level-0 {\n    border-left: 3px solid #007cba;\n}\n.indie-comments-comment.level-1 {\n    margin-left: 2rem;\n    border-left: 2px solid #888;\n}\n.indie-comments-comment.level-2 {\n    margin-left: 3rem;\n    border-left: 1px solid #ccc;\n}\n.indie-comments-comment-header {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 0.5rem;\n    font-size: 0.9rem;\n}\n.indie-comments-author {\n    font-weight: 600;\n}\n.indie-comments-date {\n    color: #888;\n}\n.indie-comments-content {\n    line-height: 1.6;\n}\n.indie-comments-replies {\n    margin-top: 1rem;\n}\n#indie-comments-theme-select {\n    padding: 0.5rem;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    background: white;\n    font-size: 0.9rem;\n    margin-left: 1rem;\n}\n/* Responsive design */\n@media (max-width: 768px) {\n    #indie-comments-app {\n        margin: 1rem;\n        padding: 1rem;\n    }\n    .indie-comments-comment.level-1,\n    .indie-comments-comment.level-2 {\n        margin-left: 1rem;\n    }\n    #indie-comments-theme-select {\n        margin-left: 0;\n        margin-top: 0.5rem;\n        width: 100%;\n    }\n}\n/* Theme styles injected dynamically */\n${this.themes[this.currentTheme]||""}\n        `,this.shadow.appendChild(n);const e=document.createElement("div");e.id="indie-comments-app",e.innerHTML=`\n            <div id="indie-comments-header">\n                <h3>Comments</h3>\n                <div id="indie-comments-message" class="indie-comments-message"></div>\n                <select id="indie-comments-theme-select" aria-label="Select theme">\n                    <option value="default">Default</option>\n                    <option value="dark">Dark</option>\n                    <option value="matrix">Matrix</option>\n                    <option value="neocities">NeoCities</option>\n                </select>\n            </div>\n            <div id="indie-comments-form-container">\n                <form id="indie-comments-form">\n                    <div class="indie-comments-input-group">\n                        <input type="text" id="indie-comments-author" name="author_name" placeholder="Your name" required />\n                    </div>\n                    <div class="indie-comments-input-group">\n                        <input type="email" id="indie-comments-email" name="author_email" placeholder="Your email" required />\n                    </div>\n                    <div class="indie-comments-input-group">\n                        <textarea id="indie-comments-content" name="content" placeholder="Write your comment..." required></textarea>\n                    </div>\n                    <button type="submit">Post Comment</button>\n                </form>\n            </div>\n            <div id="indie-comments-list">\n                ${this.comments.length>0?this.comments.map(n=>this.renderComment(n)).join(""):'<div class="indie-comments-empty">No comments yet. Be the first to comment!</div>'}\n            </div>\n        `,this.shadow.appendChild(e);const t=this.shadow.getElementById("indie-comments-theme-select");t.value=this.currentTheme,t.addEventListener("change",n=>{this.currentTheme=n.target.value,this.render(),this.dispatchEvent(new CustomEvent("themeChange",{detail:{theme:this.currentTheme},bubbles:!0,composed:!0}))});const o=this.shadow.querySelector("#indie-comments-form");o&&o.addEventListener("submit",async n=>{n.preventDefault();const e=new FormData(o),t={author_name:e.get("author_name"),author_email:e.get("author_email"),content:e.get("content")};try{await this.submitComment(t)}catch(n){console.error("Comment submission failed:",n)}})}}customElements.define("indie-comments-widget",IndieCommentsWidget),console.log("IndieCommentsWidget script loaded"),document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, checking for indie-comments-widget elements");const n=document.querySelectorAll("indie-comments-widget");console.log("Found",n.length,"indie-comments-widget elements")}),"undefined"!=typeof module&&module.exports&&(module.exports={IndieCommentsWidget:IndieCommentsWidget});